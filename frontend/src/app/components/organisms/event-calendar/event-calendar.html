<div class="card p-3 shadow-sm border-0">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="h5 mb-0 fw-bold text-primary">{{ monthLabel }}</h4>
        <div class="btn-group">
            <button class="btn btn-outline-secondary btn-sm" (click)="prevMonth()">
                <i class="bi bi-chevron-left"></i> Anterior
            </button>
            <button class="btn btn-outline-secondary btn-sm" (click)="nextMonth()">
                Siguiente <i class="bi bi-chevron-right"></i>
            </button>
        </div>
    </div>

    <div class="calendar-grid">
        <!-- Weekday Headers -->
        <div class="calendar-header-day text-muted small fw-bold text-center py-2" *ngFor="let day of weekDays">
            {{ day }}
        </div>

        <!-- Calendar Days -->
        <div *ngFor="let day of calendarDays" class="calendar-day-cell border p-1" [class.bg-light]="day.empty"
            [class.cursor-pointer]="!day.empty" (click)="!day.empty && openDayDetails(day)"
            style="min-height: 100px; position: relative;">

            <ng-container *ngIf="!day.empty">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <span class="calendar-day-number fw-semibold small ms-1">{{ day.day }}</span>
                    <span *ngIf="day.events.length > 0" class="badge bg-secondary rounded-pill"
                        style="font-size: 0.6rem;">
                        {{ day.events.length }}
                    </span>
                </div>

                <div class="events-container d-flex flex-column gap-1">
                    <div *ngFor="let event of day.events.slice(0, 3)" class="event-badge badge text-truncate w-100"
                        [ngClass]="'bg-' + getEventTypeClass(event.type)"
                        (click)="$event.stopPropagation(); navigateToActivity(event)" title="{{ event.title }}"
                        style="cursor: pointer; font-size: 0.7rem; text-align: left;">
                        {{ event.title }}
                    </div>
                    <div *ngIf="day.events.length > 3" class="text-center text-muted small" style="font-size: 0.65rem;">
                        +{{ day.events.length - 3 }} más
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</div>

<!-- Day Details Modal -->
<div class="modal" [class.show]="showDayModal" [class.d-block]="showDayModal"
    [style.background-color]="showDayModal ? 'rgba(0,0,0,0.5)' : 'transparent'" tabindex="-1" (click)="closeDayModal()">
    <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" *ngIf="selectedDay">
                    Actividades del {{ selectedDay.day }} de {{ monthLabel }}
                </h5>
                <button type="button" class="btn-close" (click)="closeDayModal()"></button>
            </div>
            <div class="modal-body">
                <div class="list-group list-group-flush" *ngIf="dayActivities.length > 0">
                    <button *ngFor="let activity of dayActivities" type="button"
                        class="list-group-item list-group-item-action" (click)="navigateToActivity(activity)">
                        <div class="d-flex w-100 justify-content-between align-items-center mb-1">
                            <h6 class="mb-0 fw-semibold">{{ activity.title }}</h6>
                            <small class="badge" [ngClass]="'bg-' + getEventTypeClass(activity.type)">
                                {{ activity.type }}
                            </small>
                        </div>
                        <p class="mb-1 small text-muted">{{ activity.description | slice:0:60 }}...</p>
                        <small class="text-muted"><i class="bi bi-clock me-1"></i>{{ activity.date }}</small>
                    </button>
                </div>
                <div *ngIf="dayActivities.length === 0" class="text-center py-4 text-muted">
                    <i class="bi bi-calendar-x fs-1 d-block mb-2"></i>
                    No hay actividades programadas para este día.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeDayModal()">Cerrar</button>
            </div>
        </div>
    </div>
</div>