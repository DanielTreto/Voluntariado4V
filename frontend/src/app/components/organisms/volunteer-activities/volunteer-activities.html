<div class="card border-0 shadow-sm rounded-4 bg-white p-4">
    <!-- Header with Tabs -->
    <div class="d-flex align-items-center mb-4 border-bottom pb-3">
        <div class="d-flex gap-3">
            <button class="btn rounded-3 px-4 fw-bold"
                [ngClass]="currentTab === 'mis-actividades' ? 'btn-primary' : 'btn-light text-secondary'"
                (click)="setTab('mis-actividades')">
                <i class="bi bi-person-check-fill me-2"></i> Mis Actividades
            </button>
            <button class="btn rounded-3 px-4 fw-bold"
                [ngClass]="currentTab === 'explorar' ? 'btn-primary' : 'btn-light text-secondary'"
                (click)="setTab('explorar')">
                <i class="bi bi-search me-2"></i> Explorar Actividades
            </button>
        </div>
    </div>

    <!-- Feedback Message -->
    <div *ngIf="message" class="alert mb-4 rounded-3" [ngClass]="{
      'alert-success': !message.includes('Error'),
      'alert-danger': message.includes('Error')
    }">
        <i class="bi" [ngClass]="!message.includes('Error') ? 'bi-check-circle' : 'bi-exclamation-triangle'"></i>
        {{ message }}
    </div>

    <!-- MY ACTIVITIES TAB -->
    <div *ngIf="currentTab === 'mis-actividades'">
        <div class="mb-4">
            <h3 class="fw-bold mb-2 text-dark">Mis Actividades</h3>
            <p class="text-muted">Gestiona tus actividades aceptadas y en curso.</p>
        </div>

        <div class="row g-4">
            <div class="col-md-6 col-lg-4" *ngFor="let activity of myActivitiesList">
                <ng-container *ngTemplateOutlet="activityCard; context: { activity: activity }"></ng-container>
            </div>
            <div *ngIf="myActivitiesList.length === 0" class="col-12 text-center text-muted py-5 bg-light rounded-3">
                <i class="bi bi-inbox fs-1 d-block mb-2 text-secondary"></i>
                No tienes actividades en curso ni solicitudes pendientes.
            </div>
        </div>
    </div>

    <!-- EXPLORE TAB -->
    <div *ngIf="currentTab === 'explorar'">
        <div class="mb-4">
            <h3 class="fw-bold mb-2 text-dark">Actividades Disponibles</h3>
            <p class="text-muted">Encuentra nuevas oportunidades de voluntariado.</p>
        </div>

        <div class="row g-4">
            <div class="col-md-6 col-lg-4" *ngFor="let activity of availableActivitiesList">
                <ng-container *ngTemplateOutlet="activityCard; context: { activity: activity }"></ng-container>
            </div>
            <div *ngIf="availableActivitiesList.length === 0"
                class="col-12 text-center text-muted py-5 bg-light rounded-3">
                <i class="bi bi-emoji-frown fs-1 d-block mb-2 text-secondary"></i>
                No hay nuevas actividades disponibles por ahora.
            </div>
        </div>
    </div>
</div>

<!-- Reusable Card Template -->
<ng-template #activityCard let-activity="activity">
    <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden activity-card-hover">
        <div class="position-relative">
            <img [src]="activity.image || 'assets/images/activity-default.jpg'" class="card-img-top"
                alt="{{ activity.title }}" style="height: 200px; object-fit: cover;">

            <div class="position-absolute top-0 end-0 p-3">
                <!-- Status Logic -->
                <span class="badge rounded-pill px-3 py-2 shadow-sm" [ngClass]="{
                    'bg-success': activity.status === 'APROBADA' || activity.status === 'EN_PROGRESO',
                    'bg-warning text-dark': activity.status === 'PENDIENTE' || (activity.requestStatus === 'PENDIENTE'), 
                    'bg-danger': activity.status === 'DENEGADA' || (activity.requestStatus === 'DENEGADA'),
                    'bg-secondary': activity.status === 'FINALIZADA'
                  }">
                    {{ activity.requestStatus || activity.status }}
                </span>
            </div>
            <div class="position-absolute bottom-0 start-0 w-100 p-3 bg-gradient-dark text-white d-none">
                <!-- Optional overlay content -->
            </div>
        </div>
        <div class="card-body d-flex flex-column p-4">
            <h5 class="card-title fw-bold mb-2 text-dark">{{ activity.title }}</h5>
            <p class="card-text text-muted small flex-grow-1" style="line-height: 1.6;">{{ activity.description |
                slice:0:100 }}...</p>

            <div class="d-flex align-items-center text-muted small mb-2">
                <i class="bi bi-calendar-event me-2 text-primary"></i> {{ activity.date | date:'mediumDate' }}
            </div>
            <div class="d-flex align-items-center text-muted small mb-4">
                <i class="bi bi-geo-alt me-2 text-primary"></i> {{ activity.location || 'Online' }}
            </div>

            <div class="mt-auto pt-3 border-top custom-card-actions">
                <!-- Buttons Logic -->
                <div *ngIf="isSignedUp(activity.id)" class="d-grid gap-2">
                    <button class="btn btn-success btn-sm rounded-pill fw-semibold" disabled>
                        <i class="bi bi-check-circle-fill me-1"></i> Participando
                    </button>
                    <button (click)="unsignUp(activity.id)" class="btn btn-outline-danger btn-sm rounded-pill">
                        Desapuntarse
                    </button>
                </div>

                <div *ngIf="isRequested(activity.id) && !isSignedUp(activity.id)" class="d-grid">
                    <button class="btn btn-warning btn-sm text-dark rounded-pill fw-semibold" disabled>
                        <i class="bi bi-hourglass-split me-1"></i> Solicitud Enviada
                    </button>
                </div>

                <div *ngIf="!isSignedUp(activity.id) && !isRequested(activity.id)" class="d-grid">
                    <button *ngIf="activity.status === 'PENDIENTE' || activity.status === 'EN_PROGRESO'"
                        (click)="signUp(activity.id)" class="btn btn-primary btn-sm rounded-pill fw-semibold">
                        <i class="bi bi-person-plus-fill me-1"></i> Solicitar Participación
                    </button>
                    <button *ngIf="activity.status !== 'PENDIENTE' && activity.status !== 'EN_PROGRESO'" disabled
                        class="btn btn-light text-secondary btn-sm rounded-pill border">
                        No disponible
                    </button>
                </div>
                <button class="btn btn-link text-primary text-decoration-none w-100 mt-2 text-center small">
                    <i class="bi bi-eye me-1"></i> Ver más
                </button>
            </div>
        </div>
    </div>
</ng-template>