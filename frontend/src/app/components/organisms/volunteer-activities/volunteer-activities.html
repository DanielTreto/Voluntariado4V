<div class="volunteer-activities-container p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">Actividades Disponibles</h2>
            <p class="text-muted mb-0">Encuentra y participa en actividades de voluntariado.</p>
        </div>
    </div>

    <div *ngIf="message" class="alert" [ngClass]="{
      'alert-success': !message.includes('Error'),
      'alert-danger': message.includes('Error')
    }">
        {{ message }}
    </div>

    <div class="row g-4">
        <div class="col-md-6 col-lg-4" *ngFor="let activity of activities">
            <div class="card h-100 shadow-sm border-0 rounded-lg overflow-hidden">
                <div class="position-relative">
                    <img [src]="activity.image || 'assets/images/activity-default.jpg'" class="card-img-top"
                        alt="{{ activity.title }}" style="height: 180px; object-fit: cover;">
                    <div class="position-absolute top-0 end-0 p-2">
                        <span class="badge" [ngClass]="{
                            'bg-success': activity.status === 'APROBADA' || activity.status === 'EN_PROGRESO',
                            'bg-warning text-dark': activity.status === 'PENDIENTE', 
                            'bg-secondary': activity.status === 'FINALIZADA'
                          }">
                            {{ activity.status }}
                        </span>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title fw-bold mb-2">{{ activity.title }}</h6>
                    <p class="card-text text-muted small flex-grow-1">{{ activity.description | slice:0:80 }}...</p>

                    <div class="d-flex align-items-center text-muted small mb-2">
                        <i class="bi bi-calendar-event me-1"></i> {{ activity.date | date:'mediumDate' }}
                    </div>
                    <div class="d-flex align-items-center text-muted small mb-3">
                        <i class="bi bi-geo-alt me-1"></i> {{ activity.location || 'Ubicación no disponible' }}
                    </div>

                    <div class="mt-auto pt-3 border-top">
                        <!-- Buttons Logic -->
                        <div *ngIf="isSignedUp(activity.id)" class="d-grid mb-2">
                            <button class="btn btn-success btn-sm" disabled>
                                <i class="bi bi-check-circle-fill me-1"></i> Participando
                            </button>
                            <button (click)="unsignUp(activity.id)" class="btn btn-outline-danger btn-sm mt-1">
                                Desapuntarse
                            </button>
                        </div>

                        <div *ngIf="isRequested(activity.id) && !isSignedUp(activity.id)" class="d-grid mb-2">
                            <button class="btn btn-warning btn-sm text-dark" disabled>
                                <i class="bi bi-hourglass-split me-1"></i> Solicitud Enviada
                            </button>
                        </div>

                        <div *ngIf="!isSignedUp(activity.id) && !isRequested(activity.id)" class="d-grid">
                            <button *ngIf="activity.status === 'PENDIENTE' || activity.status === 'EN_PROGRESO'"
                                (click)="signUp(activity.id)" class="btn btn-primary btn-sm">
                                <i class="bi bi-person-plus-fill me-1"></i> Solicitar Participación
                            </button>
                            <button *ngIf="activity.status !== 'PENDIENTE' && activity.status !== 'EN_PROGRESO'"
                                disabled class="btn btn-secondary btn-sm">
                                No disponible
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="activities.length === 0" class="text-center text-muted py-5">
        <i class="bi bi-calendar-x fs-1 d-block mb-2"></i>
        No hay actividades disponibles en este momento.
    </div>
</div>